# 排程

## 概覽

排程實現在指定時間間隔自動執行記錄上的動作。它們透過逐行循環並應用動作來處理整個表格，將手動工作流程轉變為自動化系統。

## 什麼是排程？

**排程**是：
- 觸發動作的自動計時器
- 在表格/模型層級操作
- 逐行處理記錄
- 可以篩選要處理的記錄
- 在指定的時間間隔執行

將排程視為資料自動化的「cron 作業」。

## 排程架構

```
排程：每日 Instagram 發布

配置：
  模型：社交貼文
  頻率：每天上午 9:00
  篩選器：status = "準備好" AND platform = "Instagram"
  動作：發布到 Instagram
  
執行流程：
  1. 排程在上午 9:00 觸發
  2. 找到所有匹配的記錄
  3. 對每筆記錄：
     a. 執行「發布到 Instagram」動作
     b. 處理步驟
     c. 移至下一筆記錄
  4. 處理完所有記錄後完成
```

## 建立排程

### 基本設定

**必要資訊**：
- **排程名稱**：描述性識別符
- **目標模型**：要處理哪個模型的記錄
- **動作**：要執行哪個動作
- **頻率**：何時以及多久執行一次

**範例**：
```
名稱：每日社交媒體發布
模型：社交貼文
動作：生成並發布內容
頻率：每天上午 9:00
時區：America/New_York
```

### 頻率選項

#### 每日
```
每天執行：
  時間：上午 9:00
  時區：America/New_York
  
  執行：每天上午 9:00 EST
```

#### 每週
```
每週執行：
  日：星期一
  時間：上午 8:00
  時區：UTC
  
  執行：每週一上午 8:00 UTC
```

#### 每月
```
每月執行：
  月份的日：1 日
  時間：中午 12:00
  時區：America/Los_Angeles
  
  執行：每月第一天中午 PST
```

#### 每小時
```
每小時執行：
  分鐘：:00
  小時：所有小時
  
  執行：每小時整點（1:00、2:00、3:00...）
```

#### 自訂間隔
```
每執行：
  間隔：30 分鐘
  
  執行：每 30 分鐘，全天候
```

#### Cron 表達式
```
進階使用者：
  Cron：0 9 * * MON-FRI
  
  執行：僅工作日上午 9:00
```

## 篩選記錄

### 基本篩選器

```
篩選器配置：
  欄位：status
  條件：等於
  值：「準備好」

結果：僅處理 status = "準備好" 的記錄
```

### 多個篩選器

```
AND 邏輯：
  status = "準備好"
  AND platform = "Instagram"
  AND scheduledDate <= 今天
  
  處理匹配所有條件的記錄
```

## 執行行為

### 逐行處理

```
排程一次處理一筆記錄：

表格：社交貼文（100 筆記錄匹配篩選器）

執行：
  記錄 1：執行動作 → 完成 → 繼續
  記錄 2：執行動作 → 完成 → 繼續
  記錄 3：執行動作 → 失敗 → 記錄錯誤 → 繼續
  ...
  記錄 100：執行動作 → 完成 → 完成

順序處理確保：
  - 可預測的執行
  - 資源管理
  - 清晰的錯誤追蹤
  - 速率限制合規
```

### 處理順序

```
預設：按建立日期排序（最舊的優先）
  確保 FIFO 處理

自訂順序：
  - 按優先級（高到低）
  - 按排程日期（最早優先）
  - 按自訂欄位
  - 隨機順序

範例：
  排序依據：scheduledDate ASC, priority DESC
```

### 執行限制

```
每個排程的限制：
  每次執行最多記錄：100
  最大執行時間：30 分鐘
  每個動作逾時：60 秒

如果超出限制的行為：
  - 處理到限制
  - 儲存位置
  - 下次執行時恢復
```

## 錯誤處理

### 動作失敗

```
當記錄上的動作失敗時：

選項 1：繼續（預設）
  - 記錄錯誤
  - 將記錄標記為失敗
  - 繼續到下一筆記錄
  
  最適合：個別失敗可接受的批次處理

選項 2：停止
  - 記錄錯誤
  - 停止排程
  - 不處理剩餘記錄
  
  最適合：所有都必須成功的關鍵操作
```

## 排程管理

### 檢視排程

```
排程儀表板：

活躍排程：
  ✓ 每日 Instagram 發布
    下次執行：今天上午 9:00（2 小時後）
    上次執行：昨天上午 9:00（成功：48/50）
  
  ✓ 每小時分析同步
    下次執行：23 分鐘後
    上次執行：37 分鐘前（成功：12/12）
```

### 啟用/停用排程

```
啟用排程：
  狀態：活躍
  下次執行：根據頻率計算
  通知：排程已啟用

停用排程：
  狀態：非活躍
  下次執行：無
  影響：在重新啟用之前不會執行
```

## 使用案例

### 內容發布

```
排程：自動化部落格發布
模型：部落格文章
篩選器：status = "已排程" AND publishDate <= 今天
動作：發布文章
頻率：每小時

工作流程：
  - 作者撰寫文章
  - 設定 status = "已排程"
  - 設定 publishDate
  - 排程在正確時間自動發布
```

### 社交媒體管理

```
排程：多平台發布
模型：社交貼文
篩選器：scheduled = true AND scheduledTime <= 現在
動作：發布到平台
頻率：每 15 分鐘

工作流程：
  - 內容團隊建立貼文
  - 設定排程時間
  - 排程自動發布
  - 尊重速率限制
```

## 最佳實踐

### 排程策略

**避免重疊執行**
```
好：
  排程 A：上午 9:00（需要 15 分鐘）
  排程 B：上午 10:00（安全間隔）

避免：
  排程 A：上午 9:00（需要 30 分鐘）
  排程 B：上午 9:15（可能重疊）
```

**使用適當的頻率**
```
即時需求：每 5-15 分鐘
定期處理：每小時
每日批次：每天一次
每週任務：每週一次
```

## 下一步

- [動作](./09-actions.md) - 為排程配置動作
- [使用案例](./15-use-cases.md) - 真實世界的排程場景
- [最佳實踐](./14-best-practices.md) - 優化技巧
