# 動作

## 概覽

動作是平台自動化的核心。它們定義使用 AI、API 和自訂邏輯處理資料的工作流程。動作可以推理、生成內容、進行 API 呼叫和更新記錄。

## 什麼是動作？

**動作**是：
- 處理資料的工作流程
- 由多個步驟組成
- 在個別記錄上執行
- 可以讀取和寫入欄位
- 可以建立子記錄
- 可以由手動或排程觸發

將動作視為轉換和處理資料的「智慧配方」。

## 動作架構

```
動作：「生成並發布社交內容」

觸發器：手動或排程

輸入欄位：
  - 文章.title
  - 文章.content

步驟：
  1. AI 推理 → 生成說明
  2. AI 圖像生成 → 建立視覺
  3. API 執行 → 發布到 Instagram
  4. 資料更新 → 標記為已發布

輸出欄位：
  - 社交貼文.caption
  - 社交貼文.imageUrl
  - 社交貼文.postedAt
  - 社交貼文.status
```

## 建立動作

### 基本設定

**必要資訊**：
- **動作名稱**：描述性識別符
- **目標模型**：要處理哪些模型記錄
- **描述**：動作的作用

**範例**：
```
名稱：從文章生成社交貼文
模型：社交貼文
描述：使用 AI 從部落格文章建立社交媒體內容
```

### 動作配置

```
動作設定：
  名稱：從文章生成社交貼文
  模型：社交貼文
  觸發器類型：手動、排程
  逾時：60 秒
  失敗時重試：是（3 次嘗試）
  錯誤處理：記錄並繼續
```

## 動作步驟

動作由依序執行的多個步驟組成。每個步驟都有特定的目的。

### 步驟類型

#### 1. AI 推理
```
目的：文字分析、生成、轉換
使用：語言模型處理文字
輸入：文字欄位
輸出：生成的文字
```

#### 2. AI 圖像生成
```
目的：從描述建立圖像
使用：圖像生成模型
輸入：文字提示
輸出：圖像 URL
```

#### 3. API 執行
```
目的：與外部服務互動
使用：HTTP 請求到 API
輸入：要傳送的資料
輸出：API 回應資料
```

#### 4. 資料操作
```
目的：更新記錄、建立子項
使用：內部資料庫操作
輸入：欄位值
輸出：更新的記錄
```

## AI 推理步驟

### 什麼是 AI 推理？

AI 推理使用語言模型來：
- 分析文字
- 生成內容
- 轉換資料
- 做出決策
- 提取資訊

### 配置 AI 推理

```
步驟：生成社交說明

類型：AI 推理

輸入欄位：
  - 文章.title
  - 文章.content
  - 社交貼文.platform

提示模板：
  「為此文章建立引人入勝的 {platform} 貼文：
   
   標題：{文章.title}
   內容：{文章.content}
   
   要求：
   - Twitter 少於 280 個字元
   - 包含相關主題標籤
   - 引人入勝的鉤子
   - 行動號召」

模型：GPT-4
溫度：0.7
最大令牌數：500

輸出欄位：
  - 社交貼文.caption
```

### 提示工程

**好的提示**：
```
清晰：
  「從這篇文章中提取 3 個要點並將它們列為項目符號」

具體：
  「撰寫專業的 LinkedIn 貼文（最多 200 字）關於 {主題}。包括：
   1. 引人注意的第一行
   2. 3 個關鍵見解
   3. 鼓勵參與的問題」

上下文：
  「您是行銷專家。為此產品建立 Instagram 說明：
   名稱：{產品名稱}
   功能：{功能}
   目標受眾：年輕專業人士
   語氣：友好且鼓舞人心」
```

**不好的提示**：
```
模糊：
  「寫點關於這個的東西」

太開放：
  「建立貼文」

缺少上下文：
  「使其良好」
```

## AI 圖像生成步驟

### 什麼是 AI 圖像生成？

使用 AI 模型（如 DALL-E、Midjourney 或 Stable Diffusion）從文字描述建立圖像。

### 配置圖像生成

```
步驟：生成精選圖像

類型：AI 圖像生成

輸入欄位：
  - 文章.title
  - 文章.category

提示模板：
  「為以下內容建立專業的部落格標題圖像：
   標題：{文章.title}
   類別：{文章.category}
   
   風格：現代、簡潔、極簡
   顏色：品牌顏色（藍色和白色）
   格式：16:9 橫向」

模型：DALL-E 3
大小：1792x1024
品質：HD
風格：自然

輸出欄位：
  - 文章.featuredImageUrl
```

## API 執行步驟

### 什麼是 API 執行？

向外部服務發出 HTTP 請求以：
- 發布內容
- 獲取資料
- 觸發 webhook
- 同步資訊

### 配置 API 執行

```
步驟：發布到 Instagram

類型：API 執行

連接：Instagram（來自工作區）

請求配置：
  方法：POST
  端點：/media
  標頭：
    Content-Type: application/json
    Authorization: Bearer {oauth_token}
  
主體：
  {
    "image_url": "{社交貼文.imageUrl}",
    "caption": "{社交貼文.caption}",
    "location_id": "12345"
  }

回應處理：
  成功欄位：data.id
  儲存到：社交貼文.externalId
  
  錯誤處理：
    在 429（速率限制）時：60 秒後重試
    在 401（授權）時：記錄錯誤，標記失敗
    在 500 時：重試 3 次
```

## 輸入和輸出欄位

### 使用輸入欄位

動作可以從以下讀取：
- **本地模型欄位**：當前記錄中的欄位
- **全域工作區欄位**：任何工作區模型的欄位
- **相關記錄欄位**：連結記錄的欄位

```
社交貼文模型中的範例動作：

可以存取：
  ✅ 社交貼文.platform（本地）
  ✅ 社交貼文.caption（本地）
  ✅ 文章.title（全域，透過關聯）
  ✅ 文章.content（全域，透過關聯）
  ✅ 作者.name（全域，透過文章關聯）
```

### 寫入輸出欄位

動作可以寫入：
- **當前記錄**：更新正在處理的記錄中的欄位
- **相關記錄**：更新父或連結記錄
- **新記錄**：在其他模型中建立子項

```
範例輸出：

當前記錄：
  社交貼文.caption ← 生成的說明
  社交貼文.imageUrl ← 生成的圖像
  社交貼文.status ← 「已處理」

父記錄：
  文章.socialPostsCount ← 增加 1
  文章.lastProcessed ← 當前時間戳記

新記錄：
  建立分析記錄
    source：社交貼文 ID
    processedDate：今天
```

## 動作觸發器

### 手動觸發器

```
使用者選擇記錄
點擊「執行動作」
選擇要執行的動作
確認執行
動作在選定的記錄上執行

使用案例：
  - 一次性處理
  - 執行前審查
  - 測試動作
```

### 排程觸發器

```
排程：每天上午 9:00
篩選器：status = "草稿"
動作：生成並發布
行為：處理所有匹配的記錄

使用案例：
  - 批次處理
  - 自動化工作流程
  - 重複性任務
```

### 表單提交觸發器

```
何時：透過表單建立新記錄
那麼：自動執行動作
範例：新客戶 → 傳送歡迎電子郵件

使用案例：
  - 即時處理
  - 即時自動化
  - 事件驅動的工作流程
```

## 錯誤處理

### 重試邏輯

```
動作配置：
  失敗時重試：是
  最大重試次數：3
  重試延遲：30 秒（指數退避）

行為：
  嘗試 1：執行
  失敗 → 等待 30 秒
  嘗試 2：執行
  失敗 → 等待 60 秒
  嘗試 3：執行
  失敗 → 等待 120 秒
  嘗試 4：執行
  失敗 → 標記為失敗，記錄錯誤
```

### 錯誤記錄

```
錯誤日誌項目：
  時間戳記：2025-10-20 10:30:45
  動作：生成社交貼文
  記錄 ID：1234
  步驟：AI 圖像生成
  錯誤：30 秒後 API 逾時
  重試嘗試：2/3
  狀態：重試中
```

## 最佳實踐

### 動作設計

**保持動作專注**
```
好：
  - 每個工作流程一個動作
  - 明確的目的
  - 特定的輸入/輸出

避免：
  - 做所有事情的動作
  - 太多步驟
  - 不明確的目的
```

**使用描述性名稱**
```
好：
  - 「從文章生成社交貼文」
  - 「發布到 Instagram 並追蹤分析」
  - 「向新客戶傳送歡迎電子郵件」

避免：
  - 「動作 1」
  - 「處理」
  - 「執行某事」
```

**優雅地處理錯誤**
```
- 實施重試
- 清楚地記錄錯誤
- 提供後備方案
- 在關鍵失敗時通知
```

## 下一步

- [動作步驟](./10-action-steps.md) - 每種步驟類型的詳細指南
- [排程](./12-scheduling.md) - 自動化動作執行
- [API 連接](./11-api-connections.md) - 配置外部服務
- [使用案例](./15-use-cases.md) - 真實世界的動作範例
