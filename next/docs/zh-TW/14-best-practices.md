# 最佳實踐

## 概覽

本指南提供經過驗證的策略和建議，用於在平台上建立高效、可維護和可擴展的自動化工作流程。

## 組織與結構

### 代理設計

#### 保持代理專注

**好**：
```
代理：行銷自動化
  目的：所有與行銷相關的工作流程
  工作區：
    - 內容製作
    - 社交媒體
    - 電子郵件活動
```

**避免**：
```
代理：一切
  目的：所有公司流程
  工作區：
    - 行銷
    - 銷售
    - 支援
    - HR
    - 財務
    - 營運
  
  太廣泛，難以管理
```

#### 按環境分離

```
生產代理：實時客戶資料
  - 真實 API 連接
  - 實際客戶記錄
  - 高安全性設定

預備代理：測試新功能
  - 測試 API 連接
  - 範例資料
  - 放寬驗證

開發代理：實驗
  - 模擬 API
  - 合成資料
  - 允許快速迭代
```

### 工作區組織

#### 分組相關模型

**好**：
```
工作區：部落格製作
  模型：
    - 文章（內容）
    - 作者（誰撰寫）
    - 類別（組織）
    - SEO 資料（優化）
  
  所有與部落格製作相關
```

**避免**：
```
工作區：混合一切
  模型：
    - 文章
    - 訂單
    - 支援工單
    - 庫存
  
  不相關，難以理解
```

### 模型設計

#### 正規化資料

**好**：
```
客戶模型：
  - id, name, email, tier

訂單模型：
  - id, customerId, date, total
  - 連結到客戶

一個客戶 → 多個訂單
無重複
```

**避免**：
```
訂單模型：
  - id
  - customerName（重複）
  - customerEmail（重複）
  - customerTier（重複）
  - date, total

每個訂單中的資料重複
```

## 動作設計

### 保持動作專注

**好**：
```
動作：生成社交說明
  輸入：文章標題、內容
  處理：AI 生成說明
  輸出：說明欄位
  
  單一、清晰的目的
```

**避免**：
```
動作：做所有事情
  - 生成說明
  - 生成圖像
  - 發布到 5 個平台
  - 傳送電子郵件
  - 更新分析
  - 建立報告
  
  太複雜，難以除錯
```

### 使用動作組合

**更好**：
```
動作 1：生成內容
  - 建立說明
  - 建立圖像
  
動作 2：發布到 Instagram
  - 使用生成的內容發布
  
動作 3：發布到 Twitter
  - 使用生成的內容發布

動作 4：追蹤分析
  - 獲取參與資料

模組化、可重用、可維護
```

### 錯誤處理

**實施重試**：
```
步驟：API 呼叫到 Instagram

重試配置：
  最大重試次數：3
  退避：指數
  重試條件：
    - 逾時
    - 5xx 錯誤
    - 速率限制（429）
  
  不重試條件：
    - 400（錯誤請求）
    - 401（未授權）
    - 404（未找到）
```

## API 整合

### 尊重速率限制

**實施節流**：
```
Instagram 限制：每小時 200 次呼叫

策略：
  - 追蹤已進行的呼叫
  - 調整請求速度：每分鐘約 3 次
  - 排隊超額請求
  - 限制重置時處理佇列

防止錯誤，確保可靠性
```

**使用批次操作**：
```
不好：
  對 100 個產品：
    每個單獨的 API 呼叫
  = 100 次 API 呼叫

好：
  收集 100 個產品
  批次 API 呼叫
  = 1 次 API 呼叫

更有效率
```

## 表單設計

### 最小化摩擦

**保持表單簡短**：
```
好：
  僅必要欄位：5-7 個欄位
  快速完成
  更高的完成率

避免：
  20+ 個欄位
  使用者疲勞
  高放棄率
```

**使用智慧預設值**：
```
盡可能預填：
  - 當前日期
  - 使用者姓名
  - 常見選擇
  - 先前輸入的值

節省時間，改善使用者體驗
```

## 效能優化

### 動作效能

**優化提示**：
```
慢：
  「撰寫詳細、全面、徹底的分析...」
  （生成 2000+ 字，需要 60+ 秒）

快：
  「撰寫 100 字的分析...」
  （恰好生成所需內容，需要 10 秒）

具體化，只請求您需要的
```

**批次 API 呼叫**：
```
低效：
  對 50 個貼文：
    一個一個獲取分析
  = 50 次 API 呼叫
  = 50+ 秒

高效：
  對 50 個貼文的批次請求
  = 1 次 API 呼叫
  = 2 秒
```

## 安全與隱私

### 資料保護

**清理使用者輸入**：
```
始終清理輸入：
  - 移除腳本
  - 轉義特殊字元
  - 驗證格式
  - 限制長度

防止注入攻擊
```

**加密敏感資料**：
```
加密：
  - API 憑證
  - OAuth 令牌
  - 個人資訊
  - 付款詳情

靜態和傳輸中
```

## 測試與品質

### 生產前測試

**開發工作流程**：
```
1. 在開發工作區中建立
   - 使用測試資料
   - 自由實驗
   
2. 在預備工作區中測試
   - 使用真實資料
   - 測試邊緣情況
   - 驗證整合
   
3. 部署到生產工作區
   - 真實資料
   - 密切監控
   - 準備好回滾計劃
```

**測試場景**：
```
測試：
  - 有效資料（快樂路徑）
  - 無效資料（錯誤處理）
  - 邊緣情況（邊界條件）
  - 大量（效能）
  - 缺少資料（null 處理）
```

## 成本優化

### 減少 AI API 成本

**快取結果**：
```
如果輸入沒有變更：
  - 不要重新生成
  - 使用快取輸出
  - 節省 API 呼叫

範例：
  文章沒有變更
  不要重新生成社交說明
  使用先前生成的版本
```

**使用適當的模型**：
```
GPT-4：複雜分析、重要內容
GPT-3.5-Turbo：簡單任務、大量

不要對所有事情使用 GPT-4：
  - 貴 10 倍
  - 對簡單任務來說過度
```

## 維護

### 定期審查

**每月清理**：
```
審查和清理：
  - 未使用的動作
  - 非活躍排程
  - 舊 API 連接
  - 已封存的工作區
  - 錯誤日誌

保持系統精簡
```

**季度優化**：
```
分析和優化：
  - 慢動作
  - 昂貴的 API 使用
  - 低效的工作流程
  - 未充分利用的功能

提高效能
```

## 常見陷阱

### 過度工程

```
不要：
  - 為每個可能的邊緣情況建立
  - 3 步就夠時建立 20 步
  - 過度複雜化簡單的工作流程

要：
  - 從簡單開始
  - 根據需要新增複雜性
  - 保持可維護性
```

### 規劃不足

```
不要：
  - 跳過資料建模
  - 忽略錯誤處理
  - 忘記規模
  - 急於生產

要：
  - 規劃資料結構
  - 優雅地處理錯誤
  - 為增長設計
  - 徹底測試
```

## 成功指標

### 追蹤重要事項

```
關鍵指標：
  - 每天處理的記錄
  - 動作成功率
  - 平均處理時間
  - 每筆記錄的 API 成本
  - 使用者滿意度
  - 錯誤率
  - 節省的時間 vs. 手動

衡量提供的價值
```

## 下一步

- [使用案例](./15-use-cases.md) - 看到最佳實踐的實際應用
- [疑難排解](./16-troubleshooting.md) - 解決常見問題
- [資料流](./13-data-flow.md) - 理解優化機會
